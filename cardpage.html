<!DOCTYPE html>
<html style="height: 100%;">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    {head}
    <meta name="robots" content="nosnippet">
    <meta name="keywords" content="gsa,godslayerakp,redman13,thyme1time23,giveminecraftstone,building-x">
    <meta name="theme-color" content="white">
    <meta name="color-scheme" content="light">
    <script>
        const elementClassNames = {
            "a": 'HTMLAnchorElement',
            "area": 'HTMLAreaElement',
            "audio": 'HTMLAudioElement',
            "base": 'HTMLBaseElement',
            "blockquote": 'HTMLQuoteElement',
            "body": 'HTMLBodyElement',
            "br": 'HTMLBRElement',
            "button": 'HTMLButtonElement',
            "canvas": 'HTMLCanvasElement',
            "caption": 'HTMLTableCaptionElement',
            "col": 'HTMLTableColElement',
            "colgroup": 'HTMLTableColElement',
            "data": 'HTMLDataElement',
            "datalist": 'HTMLDataListElement',
            "del": 'HTMLModElement',
            "details": 'HTMLDetailsElement',
            "dialog": 'HTMLDialogElement',
            "dir": 'HTMLDirectoryElement',
            "div": 'HTMLDivElement',
            "dl": 'HTMLDListElement',
            "embed": 'HTMLEmbedElement',
            "fencedframe": 'HTMLUnknownElement',
            "fieldset": 'HTMLFieldSetElement',
            "font": 'HTMLFontElement',
            "form": 'HTMLFormElement',
            "frame": 'HTMLFrameElement',
            "frameset": 'HTMLFrameSetElement',
            "h1": 'HTMLHeadingElement',
            "head": 'HTMLHeadElement',
            "hr": 'HTMLHRElement',
            "html": 'HTMLHtmlElement',
            "iframe": 'HTMLIFrameElement',
            "img": 'HTMLImageElement',
            "input": 'HTMLInputElement',
            "ins": 'HTMLModElement',
            "label": 'HTMLLabelElement',
            "legend": 'HTMLLegendElement',
            "li": 'HTMLLIElement',
            "link": 'HTMLLinkElement',
            "map": 'HTMLMapElement',
            "marquee": 'HTMLMarqueeElement',
            "menu": 'HTMLMenuElement',
            "meta": 'HTMLMetaElement',
            "meter": 'HTMLMeterElement',
            "object": 'HTMLObjectElement',
            "ol": 'HTMLOListElement',
            "optgroup": 'HTMLOptGroupElement',
            "option": 'HTMLOptionElement',
            "output": 'HTMLOutputElement',
            "p": 'HTMLParagraphElement',
            "param": 'HTMLParamElement',
            "picture": 'HTMLPictureElement',
            "portal": 'HTMLUnknownElement',
            "pre": 'HTMLPreElement',
            "progress": 'HTMLProgressElement',
            "q": 'HTMLQuoteElement',
            "script": 'HTMLScriptElement',
            "select": 'HTMLSelectElement',
            "slot": 'HTMLSlotElement',
            "source": 'HTMLSourceElement',
            "span": 'HTMLSpanElement',
            "style": 'HTMLStyleElement',
            "table": 'HTMLTableElement',
            "tbody": 'HTMLTableSectionElement',
            "td": 'HTMLTableCellElement',
            "template": 'HTMLTemplateElement',
            "textarea": 'HTMLTextAreaElement',
            "tfoot": 'HTMLTableSectionElement',
            "th": 'HTMLTableCellElement',
            "thead": 'HTMLTableSectionElement',
            "time": 'HTMLTimeElement',
            "title": 'HTMLTitleElement',
            "tr": 'HTMLTableRowElement',
            "track": 'HTMLTrackElement',
            "ul": 'HTMLUListElement',
            "video": 'HTMLVideoElement',
            "xmp": 'HTMLPreElement'
        };
        // loose def for elements that dont require any direct manipulation
        function defineElement(name, attributes, innerGen) {
            /** @type {HTMLElement} */
            const elClass = window[elementClassNames[extend]] ?? HTMLElement;
            class newElement extends elClass {
                static observedAttributes = Object.keys(attributes)
                    .filter(key => !key.startsWith('on') && !['extends', 'attributes'].includes(key));
                #display = null;
                #priv = {};
                constructor() {
                    super();
                    if (!this.#display) this.#display = this.attachShadow({ mode: 'open' });
                    innerGen.apply(this, [this.#display]);
                    for (const [key, val] of Object.entries(attributes)) {
                        if (key.startsWith('on')) {
                            this.addEventListener(key.slice(2), val);
                            continue;
                        }
                        this.setAttribute(key, val);
                    }
                }
            }
            for (const key in attributes) {
                if (key.startsWith('on')) {
                    switch (key.slice(2)) {
                    case 'connected':
                        newElement.prototype.connectedCallback = attributes[key];
                        delete attributes[key];
                        break;children
                    case 'disconnected':
                        newElement.prototype.disconnectedCallback = attributes[key];
                        delete attributes[key];
                        break;
                    case 'adopted':
                        newElement.prototype.adoptedCallback = attributes[key];
                        delete attributes[key];
                        break;
                    case 'attributes':
                        newElement.prototype.attributeChangedCallback = attributes[key];
                        delete attributes[key];
                        break;
                    }
                    continue;
                }
            }
            if (attributes.attributes) {
                newElement.observedAttributes = attributes.attributes;
                delete attributes.attributes;
            }
            if (attributes.this) {
                Object.assign(newElement, attributes.this);
                delete attributes.this;
            }
            delete attributes.extends;
            customElements.define(name, newElement, { extends: attributes.extends });
            return newElement;
        }
        function appendChildren(parent, children) {
            children.forEach(child => {
                if (!child) return;
                if (typeof child === 'string')
                    child = document.createTextNode(child);
                if (Array.isArray(child))
                    return appendChildren(parent, child);

                parent.appendChild(child);
            });
        }
    </script>
    
    <style>
        body {
            font-family: sans-serif;
            background: linear-gradient(to bottom, rgb(48, 127, 201) 0px, #0195FA 100vh);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .card {
            background-color: white;
            border-color: darkgrey;
            border-style: solid;
            border-width: 1px;
            border-radius: 4px;
            box-shadow: 0px 0px 20px black;
            overflow: hidden;
            position: absolute;
            z-index: 1;
            width: 480px;
            height: 360px;
            padding: 1px;
        }
        @keyframes popupAlarm {
            from {
                top: -752px
            }
            to {
                top: -330px
            }
        }
        .animateAlarm {
            animation-duration: 1s;
            animation-name: popupAlarm;
            top: -330px;
            position: absolute;
        }
        @keyframes popupTimer {
            from {
                top: -752px
            }
            to {
                top: -7px
            }
        }
        .animateTimer {
            animation-duration: 1s;
            animation-name: popupTimer;
            top: -7px;
            position: absolute;
        }
        .horizontalCenter {
            text-align: center;
        }

        @keyframes browserOpen {
            from {
                left: -170px;
                box-shadow: 0px 0px 0px black;
            }
            to {
                left: 0px;
                box-shadow: 0px 0px 20px black;
            }
        }
        @keyframes browserClose {
            from {
                left: 0px;
                box-shadow: 0px 0px 20px black;
            }
            to {
                left: -170px;
                box-shadow: 0px 0px 0px black;
            }
        }
        .browser {
            position: absolute;
            background-color: white;
            border-color: darkgrey;
            border-style: solid;
            border-width: 1px;
            border-bottom-right-radius: 8px;
            border-left-width: 0;
            box-shadow: 0px 0px 20px black;
            bottom: 0px;
            width: 170px;
            height: 360px;
            overflow: auto;
            z-index: 3;
        }
        .browser.open {
            animation-duration: 500ms;
            animation-name: browserOpen;
            box-shadow: 0px 0px 20px black;
            left: 0;
        }
        .browser.close {
            animation-duration: 500ms;
            animation-name: browserClose;
            box-shadow: 0px 0px 0px black;
            left: -170px;
        }
        @keyframes brmngOpen {
            from {
                left: 0px;
            }
            to {
                left: 170px;
            }
        }
        @keyframes brmngClose {
            from {
                left: 170px;
            }
            to {
                left: 0px;
            }
        }
        #close-browser {
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
            border-bottom-left-radius: -8px;
            background-color: white;
            border-color: darkgrey;
            border-style: solid;
            border-width: 1px;
            border-left-width: 0;
            position: absolute;
            left: 170px;
            z-index: 3;
        }
        #close-browser.open {
            animation-duration: 500ms;
            animation-name: brmngOpen;
            left: 170;
        }
        #close-browser.close {
            animation-duration: 500ms;
            animation-name: brmngClose;
            left: 0;
        }
        .browser .folder {
            padding-left: 1em;
            cursor: pointer;
        }
        .browser .folder span {
            padding-left: 0.1em;
        }
        .browser .folder.noicon {
            padding-left: 1em;
        }
        .browser .folder.opened.noicon::before {
            content: 'v';
            font-weight: bold;
            display: inline-block;
            text-align: center;
            height: 1em;
            width: 1em;
        }
        .browser .folder.closed.noicon::before {
            content: 'v';
            font-weight: bold;
            display: inline-block;
            transform: rotate(-90deg);
            text-align: center;
            height: 1em;
            width: 1em;
        }
        .browser .folder.opened div {
            display: block;
        }
        .browser .folder.closed div {
            display: none;
        }
        .browser .file {
            padding-left: 1em;
            cursor: pointer;
        }
        .browser .file span {
            padding-left: 0.1em;
        }
        .browser .file.noicon {
            padding-left: 1em;
        }
        .browser .file.selected {
            background-color: rgb(192, 192, 192);
            border-top-color: grey;
            border-top-width: 1px;
            border-top-style: solid;
            border-bottom-color: grey;
            border-bottom-width: 1px;
            border-bottom-style: solid;
        }
        .browser img {
            width: 1em;
            height: 1em;
            object-fit: fill;
            vertical-align: sub;
        }
    </style>
</head>
<body style="margin: 0; height: 100%;">
    <div class="card">
        <noscript>Dont be allarmed! it looks like you have scripts dissabled, this site uses scripts to make certain renders (like scaling this card) work and display correctly</noscript>
        <div class="browser close" id="browser" hidden>"filejson"</div>
        <button id="close-browser" class="close" hidden>&gt;</button>
        <script file="jsx">   
            /** @import { BrowserFolder } from './builder/precomp-manager.js' */
            const sortOrder = 'abcdefghijklmnopqrstuvwxyz';
            /**
             * makes a browser
             * @param {BrowserFolder} json - the filesystem-shape to be displayed in the browser
             * @param {boolean} makeTop - if or if not to return only the inner members of the folder or the raw folder
             * @return {HTMLDivElement} - the browser
             */
            function makeBrowser(json, makeTop = true) {
                /** @type {HTMLDivElement} */
                const folder = <div 
                    class={`folder ${
                        json.resolve || json.selected 
                            ? 'opened' 
                            : 'closed'
                    } ${json.icon 
                            ? 'noicon' 
                            : ''
                    }`}
                    onclick={e => {
                        e.stopPropagation();
                        if (!json.resolve) {
                            e.target.classList.toggle('opened');
                            e.target.classList.toggle('closed');
                        } else
                            window.open(folder.resolve, '_self');
                    }}
                >
                    {json.icon
                        ? <img src={json.icon} />
                        : null
                    }
                    <span>{json.name}</span>
                    <div>{
                        json.members.sort((a,b) => {
                            const aHasSort = typeof a.sort !== 'undefined';
                            const bHasSort = typeof b.sort !== 'undefined'; 
                            const aHasName = typeof a.name !== 'undefined';
                            const bHasName = typeof b.name !== 'undefined'; 
                            if (a.members && b.resolve && !aHasSort) return -1;
                            if (a.resolve && b.members && !bHasSort) return 1;
                            const aName = (!aHasSort && aHasName)
                                ? [...a.name.toLowerCase()]
                                    .reverse()
                                    .map((char, idx) => sortOrder.indexOf(char) * idx)
                                    .reduce((pre, cur) => pre + cur, 0)
                                : a.sort;
                            const bName = (!bHasSort && bHasName)
                                ? [...b.name.toLowerCase()]
                                    .reverse()
                                    .map((char, idx) => sortOrder.indexOf(char) * idx)
                                    .reduce((pre, cur) => pre + cur, 0)
                                : b.sort;
                            return aName - bName;
                        })
                        .map(file => file.member 
                            ? makeBrowser(file, false)
                            : <div class={`file ${
                                file.selected 
                                    ? 'selected' 
                                    : ''
                                } ${file.icon 
                                    ? '' 
                                    : 'noicon'
                                }`}
                            >
                                {file.icon
                                    ? <img src={file.icon} />
                                    : null
                                }
                                <span>{file.name}</span>
                            </div>)
                    }</div>
                </div>;
                return makeTop ? folder.getElementsByTagName('div')[0] : folder;
            }

            const browser = document.getElementById('browser');
            const close = document.getElementById('close-browser');
            close.onclick = e => {
                browser.classList.toggle('open');
                browser.classList.toggle('close');
                close.classList.toggle('open');
                close.classList.toggle('close');
                close.innerText = close.classList.contains('open') ? '<' : '>'
            }
            function enableBrowser() {
                browser.hidden = false;
                close.hidden = false;
            }
            function clearBrowser() {
                browser.innerHTML = '';
            }
            function updateBrowser(pages) {
                const html = makeBrowser(pages);
                html.style.width = 'max-content';
                clearBrowser();
                browser.appendChild(html);
            }
            /** @type {BrowserFolder} */
            const files = JSON.parse(browser.innerText);
            /** @type {Array<string>} */
            const pages = (localStorage.pages || location.pathname).split(',');
            if (!pages.includes(location.pathname)) pages.push(location.pathname);
            if (files.pages <= pages.length) { enableBrowser(); updateBrowser(files); }
            localStorage.pages = pages.join();
        </script>
        <div id="main" style="
            width: 100%; 
            height: 100%; 
            overflow-wrap: break-word; 
            overflow-x: hidden; 
            overflow-y: auto; 
            position: absolute;
        ">
            <div>{body}</div>
        </div>
    </div>
    <script>
        const scaleOffset = 0.20

        window.exploading = false
        window.scale = 1

        const waitTime = time => new Promise(resolve => setTimeout(resolve, time))
        async function initiateSelfDestruct() {
            console.log('omg you made the site expload how dare you!!!!!!!!!!!!!!!!!!!!!!!!!!!11')
            document.body.style.background = ''
            document.body.style.backgroundColor = 'red'
            exploading = true
            let timer = 10
            const timerText = document.createElement('p')
            timerText.style.position = 'absolute'
            timerText.style.left = '50%'
            timerText.style.transform = 'translate(-50%, 0)'
            timerText.innerText = timer
            timerText.classList.add('animateTimer')

            const alarm = document.createElement('img')
            alarm.src = './alarm.gif'
            await new Promise(resolve => {
                alarm.onload = resolve
                alarm.onerror = () => {
                    console.error('aw man what the fuck, the alarm gif couldnt be loaded')
                }
            })
            alarm.style.position = 'absolute'
            alarm.style.left = '50%'
            alarm.style.transform = 'translate(-50%, 0) scale(0.2)'
            alarm.classList.add('animateAlarm')

            document.body.appendChild(alarm)
            document.body.appendChild(timerText)

            const video = document.createElement('video')
            video.style.display = 'none'
            video.style.width = '100%'
            video.style.height = '100%'
            video.innerHTML = '<source src="./finally your awake.mp4" type="video/mp4" />'

            const timerInt = setInterval(async () => {
                timer--
                timerText.innerText = timer
                if (timer < 1) {
                    document.body.style.backgroundColor = 'black'
                    document.body.innerHTML = ''
                    video.style.display = ''
                    document.body.appendChild(video)
                    await waitTime(1000)
                    video.play().catch(() => {
                        video.style.display = 'none'
                        document.body.style.backgroundColor = 'white'
                        document.body.innerHTML = `man your no fun >:(. <br> how dare you block auto video playback making it so i cant play <a href="./finally your awake.mp4">finally your awake.mp4</a>`
                    })
                    clearInterval(timerInt)
                }
            }, 1000)
        }

        // i have 0 clue how the fuck im supposed to do the scaling with css, and having it clearly saved is better anyways
        function computeSize() {
            if (exploading) return
            const width = window.innerWidth
            const height = window.innerHeight
            const card = document.getElementsByClassName('card')[0];
            const cw = card.offsetWidth;
            const ch = card.offsetHeight;
            const old = scale;
            window.scale = Math.min(width / cw, height / ch) - scaleOffset
            if (scale <= 0) {
                scale = 0
                initiateSelfDestruct()
            }
            card.setAttribute('scale', scale)
            card.style.transform = `scale(${scale})`;
            window.oncardrescale?.(old);
        };
        computeSize();
        window.onresize = computeSize;

        window.debug = false;
        const debug = new WebSocket(`/debug${location.pathname}`);
        debug.onopen = () => window.debug = true;
        debug.onmessage = ev => {
            switch (ev.message) {
            case 'reload': location.reload(); break;
            case 'close': close();
            }
        }
    </script>
</body>
</html>
